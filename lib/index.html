<html>
	<head>
		<title>Chart-mysql demo</title>
		<script
				src="https://code.jquery.com/jquery-3.2.1.min.js"
				integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
				crossorigin="anonymous"></script>

		<script src="canvas.js"></script>
		<script>
			// code to draw graph
			jQuery.ajax({
				url: "/chart" + document.location.search,
				success: function( result ) {
					var chart = new CanvasJS.Chart("chartContainer", {
						title: {
							text: "Test",
							fontSize: 30
						},
						toolTip: {
							shared: true,
							contentFormatter: e => {
								var str = `${e.entries[0].dataPoint.dateString}<br>`;
								for (var i = 0; i < e.entries.length; i++){
									var  temp = `<span style="color: ${e.entries[i].dataSeries.color}">${e.entries[i].dataSeries.name}:</span> ${e.entries[i].dataPoint.y}`;
									if(i == 0 || i == 2 )
										temp += ` (${((100*(e.entries[i].dataPoint.y/e.entries[1].dataPoint.y))-100).toFixed(2)}%)`;

									str = str.concat(`${temp}<br>`);
								}
								return (str);
							}
						},
						animationEnabled: true,
						axisX: {
							gridColor: "Silver",
							tickColor: "silver",
							valueFormatString: "DD/MM HH:mm:ss"
						},
						theme: "theme2",
						axisY: {
							includeZero: false,
							gridColor: "Silver",
							tickColor: "silver"
						},
						legend: {
							verticalAlign: "center",
							horizontalAlign: "right"
						},
						data: [
							{
								type: "line",
								showInLegend: true,
								lineThickness: 2,
								name: "Ask",
								markerType: "square",
								color: "#F08080",
								dataPoints: result.asks
									.filter(item => item.x && item.y)
									.map(item => {
										item.dateString = item.x;
										item.x = new Date(item.x);
										return item;
									})
							},
							{
								type: "line",
								showInLegend: true,
								name: "US Price",
								color: "#20B2AA",
								lineThickness: 2,

								dataPoints: result.us
									.filter(item => item.x && item.y)
									.map(item => {
										item.dateString = item.x;
										item.x = new Date(item.x);
										return item;
									})
							},
							{
								type: "line",
								showInLegend: true,
								name: "Bid",
								color: "#b28155",
								lineThickness: 2,

								dataPoints: result.bids
									.filter(item => item.x && item.y)
									.map(item => {
										item.dateString = item.x;
										item.x = new Date(item.x);
										return item;
									})
							}
						],
						legend: {
							cursor: "pointer",
							itemclick: function (e) {
								if (typeof (e.dataSeries.visible) === "undefined" || e.dataSeries.visible) {
									e.dataSeries.visible = false;
								}
								else {
									e.dataSeries.visible = true;
								}
								chart.render();
							}
						}
					});

					chart.render();
				}
			});
		</script>
	</head>

	<body>
	<div id="chartContainer" style="height: 400px; width: 100%;">
	</div>
	</body>
</html>