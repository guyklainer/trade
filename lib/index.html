<html>
	<head>
		<title>Chart-mysql demo</title>
		<script
				src="https://code.jquery.com/jquery-3.2.1.min.js"
				integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
				crossorigin="anonymous"></script>

		<script src="canvas.js"></script>
		<script>
			// code to draw graph
			jQuery.ajax({
				url: "/chart",
				success: function( result ) {
					console.log(result.bids
						.filter(item => item.x && item.y)
						.map(item => {
							item.x = new Date(item.x);
							return item;
						}));
					var chart = new CanvasJS.Chart("chartContainer", {
						title: {
							text: "Test",
							fontSize: 30
						},
						animationEnabled: true,
						axisX: {
							gridColor: "Silver",
							tickColor: "silver",
							valueFormatString: "DD/MM HH:mm:ss"
						},
						toolTip: {
							shared: true
						},
						theme: "theme2",
						axisY: {
							includeZero: false,
							gridColor: "Silver",
							tickColor: "silver"
						},
						legend: {
							verticalAlign: "center",
							horizontalAlign: "right"
						},
						data: [
							{
								type: "line",
								showInLegend: true,
								lineThickness: 2,
								name: "Bid",
								markerType: "square",
								color: "#F08080",
								dataPoints: result.bids
									.filter(item => item.x && item.y)
									.map(item => {
										item.x = new Date(item.x);
										return item;
									})
							},
							{
								type: "line",
								showInLegend: true,
								name: "US Price",
								color: "#20B2AA",
								lineThickness: 2,

								dataPoints: result.us
									.filter(item => item.x && item.y)
									.map(item => {
										item.x = new Date(item.x);
										return item;
									})
							},
							{
								type: "line",
								showInLegend: true,
								name: "Ask",
								color: "#b28155",
								lineThickness: 2,

								dataPoints: result.asks
									.filter(item => item.x && item.y)
									.map(item => {
										item.x = new Date(item.x);
										return item;
									})
							}
						],
						legend: {
							cursor: "pointer",
							itemclick: function (e) {
								if (typeof (e.dataSeries.visible) === "undefined" || e.dataSeries.visible) {
									e.dataSeries.visible = false;
								}
								else {
									e.dataSeries.visible = true;
								}
								chart.render();
							}
						}
					});

					chart.render();
				}
			});
		</script>
	</head>

	<body>
	<div id="chartContainer" style="height: 400px; width: 100%;">
	</div>
	</body>
</html>